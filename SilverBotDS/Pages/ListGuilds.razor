@page "/listguilds"
@using SilverBotDS.WebHelpers
@using SilverBotDS.Objects
@using Microsoft.AspNetCore.Http
@using DSharpPlus
@using System.Text
@inject Config config
@inject IHttpContextAccessor HttpContextAccessor
@inject DiscordClient Discord
@inject IJSRuntime jsRuntime
@inject NavigationManager uriHelper
@inject HttpClient client
@{
    if (string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Session.GetObjectFromJson<string>("accessToken")))
    {
        uriHelper.NavigateTo("/login", true);
    }
    var thing = HttpContextAccessor.HttpContext.Session.GetUserInfoFromSession(client);
    var servers = from server in HttpContextAccessor.HttpContext.Session.GetGuildsFromSession(client)
        where Discord.Guilds.ContainsKey(server.UId) && (Discord.Guilds[server.UId].GetMemberAsync(thing.UId).GetAwaiter().GetResult().Roles.Any(e => e.CheckPermission(Permissions.ManageGuild) == PermissionLevel.Allowed) || server.Owner)
        select server;
}
<h1>The servers you can manage:</h1>
<div>
<div class="card-body">
    <div class="row justify-content-center">
        @foreach (var server in servers)
    {
            <div class="row">
            <div class="m-2 center col">
            <a href="/manageserver/@server.Id">
                @if (string.IsNullOrEmpty(server.Icon))
                {
                    var split_name = server.Name.Split(' ');
                    var sb = new StringBuilder();
                    foreach (var s in split_name)
                    {
                        sb.Append(s[0]);
                    }
                    <div style="text-align:center; width: 100px; height: 100px; border: 1px solid #000; background-color: #000; display: flex; justify-content: center; align-items: center;">
                        <p style="color:white; font-size: 30px; font-family: Whitney,Helvetica Neue,Helvetica,Arial,sans-serif;">@sb.ToString()</p>
                    </div>
                }
                else
                {
                    
                <img height="100" width="100" src="https://cdn.discordapp.com/icons/@server.Id/@(server.Icon).png" alt="@server.Name's image">
                }
                <p class="text-center">@server.Name</p>
            </a>
            </div>
                    </div>
                }
    </div>
</div>
</div>       